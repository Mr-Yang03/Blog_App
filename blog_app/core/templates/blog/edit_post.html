{% extends 'base/base.html' %}
{% load static %}

{% block title %}Edit Post - Blog App{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/post_form.css' %}">
{% endblock %}

{% block content %}
<div class="post-form-container">
    <div class="post-form-header">
        <h1>Edit Post</h1>
        <a href="{% url 'blog:post_detail' post.slug %}" class="btn-secondary">Cancel</a>
    </div>

    <form method="post" enctype="multipart/form-data" class="post-form">
        {% csrf_token %}

        <div class="form-group">
            <label for="title">Title *</label>
            <input type="text" id="title" name="title" value="{{ post.title }}" required maxlength="200" placeholder="Enter post title">
        </div>

        <div class="form-group">
            <label for="excerpt">Excerpt</label>
            <textarea id="excerpt" name="excerpt" rows="3" maxlength="300" placeholder="Brief summary of your post (max 300 characters)">{{ post.excerpt }}</textarea>
            <small>This will be shown in post previews</small>
        </div>

        <div class="form-group">
            <label for="content">Content *</label>
            <textarea id="content" name="content" required rows="15" placeholder="Write your post content here...">{{ post.content }}</textarea>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="category">Category</label>
                <select id="category" name="category">
                    <option value="">-- Select Category --</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if post.category.id == category.id %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="status">Status *</label>
                <select id="status" name="status" required>
                    <option value="draft" {% if post.status == 'draft' %}selected{% endif %}>Draft</option>
                    <option value="published" {% if post.status == 'published' %}selected{% endif %}>Published</option>
                    <option value="archived" {% if post.status == 'archived' %}selected{% endif %}>Archived</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="tags">Tags</label>
            <select id="tags" name="tags" multiple>
                {% for tag in tags %}
                    <option value="{{ tag.id }}" {% if tag in post.tags.all %}selected{% endif %}>{{ tag.name }}</option>
                {% endfor %}
            </select>
            <small>Hold Ctrl (Windows) or Cmd (Mac) to select multiple tags</small>
        </div>

        <div class="form-group">
            <label for="featured_image">Featured Image</label>
            {% if post.featured_image %}
                <div class="current-image">
                    <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" style="max-width: 300px; margin-bottom: 10px;">
                    <p>Current image</p>
                </div>
            {% endif %}
            <input type="file" id="featured_image" name="featured_image" accept="image/*">
            <small>Upload new image to replace current one. Recommended size: 1200x630 pixels</small>
        </div>

        <div class="form-group checkbox-group">
            <label>
                <input type="checkbox" name="is_featured" {% if post.is_featured %}checked{% endif %}>
                <span>Mark as Featured Post</span>
            </label>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Update Post</button>
            <a href="{% url 'blog:post_detail' post.slug %}" class="btn-secondary">Cancel</a>
        </div>
    </form>

    <!-- Delete Post Form -->
    <div class="danger-zone">
        <h3>Danger Zone</h3>
        <form method="post" action="{% url 'blog:delete_post' post.slug %}" onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone.');">
            {% csrf_token %}
            <button type="submit" class="btn-danger">Delete Post</button>
        </form>
    </div>
</div>
{% endblock %}
